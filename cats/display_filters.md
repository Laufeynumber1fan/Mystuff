# Also known as `tshark/wireshark` filters 

Misc docs:  
[What are checksums for?](https://www.wireshark.org/docs/wsug_html_chunked/ChAdvChecksums.html)  
  
## *`tcpdump` + `tshark`*

#### Combining dumpshark
tshark has limitations with 1 GB pcaps which is when tcpdump plays a role in pcap analysis. tshark will still parse large pcaps but may take 1 min+ after every command.  

Consider the following tcpdump command:  
`tcpdump -r foo.pcapng arp src host 192.168.184.132`
```
11:10:00.130346 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
11:10:26.242486 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
11:10:51.842131 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
11:11:17.442129 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
...
```
This tells a summary of the packets but in order for advanced analysis with tshark filters, the only unique identifier between these packets is time, specifically `frame.time`.  

Add these two args `-tt` and `--time-stamp-precision=nano`:  
`tcpdump -r foo.pcapng arp src host 192.168.184.132 -tt --time-stamp-precision=nano `
```
1745421000.130346262 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
1745421026.242486890 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
1745421051.842131374 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
1745421077.442129735 ARP, Request who-has 192.168.184.1 tell 192.168.184.132, length 28
...
```
In order to see the 2nd packet in tshark you combine this with tshark's `frame.time_epoch` and `-V`:  
`tshark -r foo.pcapng -Y "frame.time_epoch==1745421026.242486890" -V | less`
```
Frame 34: 42 bytes on wire (336 bits), 42 bytes captured (336 bits) on interface ens33, id 0
    Section number: 1
    Interface id: 0 (ens33)
        Interface name: ens33
    Encapsulation type: Ethernet (1)
    Arrival Time: Apr 23, 2025 11:10:26.242486890 EDT
    UTC Arrival Time: Apr 23, 2025 15:10:26.242486890 UTC
    Epoch Arrival Time: 1745421026.242486890
...
```
You can combine filters in tshark to fetch the range of epoch times generated by tcpdump:  
`tshark -r foo.pcapng -Y "frame.time_epoch>=1745421000.130346262 and frame.time_epoch <=1745421077.442129735 and arp.src.proto_ipv4==192.168.184.132"`
  
## ARP
#### ARP TYPE  
`arp.opcode` Filter arp packets based on type.  
`arp.opcode==1` are arp requests. `arp.opcode==2` are arp replies.  
More opcodes [here](https://www.iana.org/assignments/arp-parameters/arp-parameters.xhtml#arp-parameters-1)

## TCP

#### TCP FLAGS  
More flags [here](https://www.iana.org/assignments/tcp-parameters/tcp-parameters.xhtml#tcp-header-flags)

#### TCP HANDSHAKES  
`tcp.completeness` Filters tcp packets based on the progression of their handshake.  
For example: `tcp.completeness==7` filters packets that are transmitting **data payloads**. [ref](https://www.wireshark.org/docs/wsug_html_chunked/ChAdvTCPAnalysis.html#_tcp_conversation_completeness)  
Note: The bitmask chart on the [ref](https://www.wireshark.org/docs/wsug_html_chunked/ChAdvTCPAnalysis.html#_tcp_conversation_completeness) needs to be minus by one! The bitmask is 64 bits long so `tcp.completeness==0` refers to SYNs, `tcp.completeness==1` refers to SYN-ACKs, and so on.

*Why use `tcp.completeness` and not `tcp.flags`?*  
One argument is that tcp.completeness values are more sequential in the TCP handshake. Like `0` is the start and `31` is the finish. Whereas `tcp.flags` would have `2` as SYN and then `4` as RST. So unlike in `tcp.flags` you can use `>` and `<` for `tcp.completeness` and it will be a range on the handshake progression of TCP packets.  
  
Examples `tcp.completeness`:  
`tcp.completeness<4 && tcp.flags!=20` displays packets doing the SYN handshake but exclude any (RST, ACK) flags.  
`tcp.completeness==31` displays packets doing the FIN handshake.  

#### TCP DATA PAYLOAD
`tcp contains ****` can be used to filter out hexdumps of TCP payloads.  
For example, consider the word "velociraptor", to look for data payloads with that word you can use `contains` filter `tcp contains "velociraptor"`

`contains` is a simplified version of `tcp.payload` which is used to search for hex.  

`tshark -r foo.pcap -Y tcp -T fields -e tcp.payload | grep 76656c6f6369726170746f72` is the same as `tcp contains "velociraptor` but with tcp.payload you can spot how many times the word "velociraptor" appears in a packet or the entire pcap with cmdline tools.  

  
TODO: ADD THESE  
`tcp_hdr.len` Length of the TCP header  
`tcp.len` Length of TCP payload  
`ip_hdr.len` Lenght of the IP header  
`ip.len` Size of the IP frame (including headers, loks like)  
`frame.len` Length of the on-the-wire frame (ethernet, most probably)  
`frame.cap_len` Length of the capture  